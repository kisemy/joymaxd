
<h4>Editing Payment Voucher</h4>
<%= form_with(model: @payment) do |f| %>


<div class="container-fluid page__container">
  
  <div class="row">
    <div class="col-md-9 offset-md-2">
      <div class="card">
        <div class="card-body">



     
       
          <div class="px-3">

            <div class="d-flex justify-content-center flex-column text-center my-5 navbar-light">
              <class="navbar-brand d-flex flex-column m-0" style="min-width: 0">
                  <%= image_tag "safaricomlogo.png", :size => "300x100" %>
                
              </a>
            <strong><h1>PAYMENT VOUCHER</h1></strong>
            </div>
            
            
 <div class="card card-form">
                  
         


<div class="containerpv">

  <div class="content">

                  <div class="container">
		  <label for="roundedSample01">Payment Date:</label><br>
		 
                  <%= f.text_area :payment_date, class: 'styled-textarea' %>
            
		</div>
<br>
                 <div class="container">
		  <label for="textarea">Paying Account Code:</label><br>
		 
                   <%= f.text_area :paying_account_code, class: 'styled-textarea'  %><br>
                   
                
		</div>
		
		
	

 

	
		
		
		
		
		
		
		
<br>
                  <div class="container">
		  <label for="textarea">Paying Description:</label><br>
		 
                
                  <%= f.text_area :paying_acc_description, id: "payment-paying_acc_description" %>
		</div>
<br>

                 <div class="container">
		  <label for="textarea">Prepared by:</label><br>
		 
                   <%= f.text_area :prepared_by, class: 'styled-textarea' %><br>
          
		</div>

<br>
                  <div class="container">
		  <label for="textarea">Mode of Payment:</label><br>
		 
                   <%= f.text_area :mode_of_payment, class: 'styled-textarea' %><br>
          
		</div>
<br>
               <div class="container">
		  <label for="textarea">Payment Description:</label><br>
		 
                   <%= f.text_area :payment_description, class: 'styled-textarea' %><br>
          
		</div>
<br>
             <div class="container">
		  <label for="textarea">Status:</label><br>
		 
                   <%= f.text_area :status, class: 'styled-textarea'%><br>
          
		</div>
		
		</div>
		
		
		
		
		

 <div class="content"> 
                 
        <div class="col-lg text">
 
 
                  <div class="container">
		  <label for="textarea">Document No:</label><br>
		 
                   <%= f.text_area :documentno, class: 'styled-textarea' %><br>
          
		</div>
		</div>
    
       
<br>

           <div class="col-lg text">
                 <div class="container">
		  <label for="textarea">Release Date:</label><br>
		 
                   <%= f.text_area :release_date, class: 'styled-textarea' %><br>
          
          </div>
		</div>
		
		
		
    
          
<br>

         
         <div class="col-lg text">
                 <div class="container">
		  <label for="textarea">Posted:</label><br>
		 
                   <%= f.text_area :posted, class: 'styled-textarea'   %><br>
          
		</div>
		
		 </div>
		
		
		
		
   
      
       
                 
        <div class="col-lg text">

                 <div class="container">
		  <label for="textarea">Amount:</label><br>
		 
                   <%= f.text_area :amount, class: 'styled-textarea'   %><br>
          
		</div>
    
             </div>

 <div class="col-lg text">

                 <div class="container">
		  <label for="textarea">Payee Code:</label><br>
		 
                   <%= f.text_area :payee_code, class: 'styled-textarea'   %><br>
          
		</div>
    
             </div>
<br>

				 
 <div class="col-lg text">

                 <div class="container">
		  <label for="textarea">Payee Name:</label><br>
		 
                   <%= f.text_area :payee_name, class: 'styled-textarea'   %><br>
          
		</div>
    
             </div>
<br>		

<div class="col-lg text">

                 <div class="container">
		  <label for="textarea">Account Type:</label><br>
		 
                   <%= f.text_area :account_type, class: 'styled-textarea'  %><br>
          
		</div>
    
             </div>
<br>		
	
<div class="col-lg text">

                 <div class="container">
		  <label for="textarea">Category Type</label><br>
		 
                   <%= f.text_area :category_type, class: 'styled-textarea'   %><br>
          
		</div>
               </div>
<br>
 </div>
 </div>

  
  
   
  
  
  
      
      
      
            

<p>Total Payment: <%= @total_payment %></p>
 
  <h3>Payment Lines</h3>
  <div class="table-responsive">
    <table id="paymentlines" class="table table-bordered">
      <thead>
        <tr>
          <th>Account Type</th>
          <th>Account Name</th>
          <th>Description</th>
          <th>Amount</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <%= f.fields_for :paymentlines do |item| %>
          <%= render 'paymentline_fields', f: item %>
        <% end %>
      </tbody>
    </table>
  </div>

  <!-- Button to add new paymentline rows -->
  <button type="button" id="add_paymentline">Add Payment Line</button>

  <%= f.submit 'Save Payment' %>

            
   





<div class="row border border-dark p-2">



<br>
  <%= link_to "Add Product", add_field_path(format: :js), {method: :post, remote: true, id: "addProductBtn", class: 'btn btn-primary'} %>

      <div class="col">

      </div>

      <div class="col">
        <div class="row">
          <div class="col">
            Sub Total:
          </div>
          <div class="col">
            <!--  we need to fix the precision on the totals at some point 
            $ <= @invoice.amount_due %> -->
          </div>
        </div>

        <div class="row font-weight-bold">
          <div class="col">
            Grand Total Due:
          </div>
          <div class="col">
            <!--  we need to fix the precision on the totals at some point 
            $ <= @invoice.grand_total unless request.url.match('/invoices/new')%>  -->
          </div>
        </div>
      </div>
    </div>

<br>
<br>
    <div class="row action">
      <div class="col-10">
      </div>

      <div class="float-right col-2">
        <%= f.submit "Update Payment", class: 'btn btn-primary' %>

   <%= link_to 'post Payment', {:controller => "payments", :action => "postgl2"}, :method=>:post %>



      </div>

    </div>
    
    <br>
    <br>
    
    
    <%= link_to 'post Payment', {:controller => "payments", :action => "postgl2"}, :method=>:post %>
    <br>
    <br>
    class: 'btn btn-primary' %>
   
    <%= link_to 'Create Ledger', {:controller => "payments", :action => "insert_into_gledger", :id => @payment.id}, :method => :post %>


   </div>
    
    
    

<% end %>


<div class="text-label">Notes</div>
            <p class="text-muted">We appreciate your business. Should you need us to add VAT or extra notes let us know!</p>
          </div>
        












</div>



<script>
document.addEventListener('DOMContentLoaded', function() {
  // Add new payment line
  document.getElementById('add_paymentline').addEventListener('click', function() {
    const template = document.querySelector('script[type="text/template"]').innerHTML;
    const tbody = document.querySelector('#paymentlines tbody');
    const newRow = document.createElement('tr');
    newRow.innerHTML = template.replace(/new_paymentlines/g, new Date().getTime()); // Ensure unique IDs
    tbody.appendChild(newRow);
  });

  // Remove payment line
  document.addEventListener('click', function(event) {
    if (event.target.classList.contains('remove_fields')) {
      event.preventDefault();
      const row = event.target.closest('tr');
      row.remove();
    }
  });

  // Fetch account numbers based on account type
  document.addEventListener('change', function(event) {
    if (event.target.classList.contains('account_type')) {
      const accountType = event.target.value;
      const accountnoSelect = event.target.closest('tr').querySelector('.accountno');

      fetch(`/payments/fetch_accountno?account_type=${accountType}`)
        .then(response => response.json())
        .then(data => {
          accountnoSelect.innerHTML = '<option value="">Select Account Number</option>';
          data.accountno_options.forEach(accountno => {
            accountnoSelect.innerHTML += `<option value="${accountno}">${accountno}</option>`;
          });
        });
    }
  });
});


</script>

<style>
.styled-textarea {
  width: 100%;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

.table-bordered {
  border: 1px solid #ddd;
}

.table-bordered th, .table-bordered td {
  border: 1px solid #ddd;
  padding: 8px;
}

.remove_fields {
  color: red;
  text-decoration: none;
}
</style>






<%= link_to 'Show', @payment %> |
<%= link_to 'Back', payments_path %>
