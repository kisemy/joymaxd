<!-- Skin configuration box -->
<!-- <%= render 'layouts/skinconfig' %> -->

    <!-- Wrapper-->
<div id="wrapper" class="<%= params[:controller] %>.<%= params[:action] %>">

        <!-- Navigation -->
        <%= render 'layouts/navigation' %>

        <!-- Page wraper -->
        <div id="page-wrapper" class="gray-bg <%= @extra_class %>">

            <!-- Page wrapper -->
            <%= render 'layouts/topnavbar' %>

            <!-- Main view  -->



<%= form_with(mode: invoice, local: true) do |form| %>
  <% if invoice.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(invoice.errors.count, "error") %> prohibited this invoice from being saved:</h2>

      <ul>
        <% invoice.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
  
 
  

  <div class="field">
    <%= form.label :customer_name %>
    <%= form.text_area :customer_name, {class: 'form-control'} %>
  </div>

  <div class="field">
    <%= form.label :contactno %>
    <%= form.text_area :contactno, {class: 'form-control'} %>
  </div>

  <div class="field">
    <%= form.label :contact_name %>
    <%= form.text_area :contact_name, {class: 'form-control'} %>
  </div>

  <div class="field">
    <%= form.label :address %>
    <%= form.text_area :address, {class: 'form-control'} %>
  </div>

  <div class="field">
    <%= form.label :city %>
    <%= form.text_area :city, {class: 'form-control'} %>
  </div>

  <div class="field">
    <%= form.label :date %>
    <%= form.date_select :date, {class: 'form-control'} %>
  </div>

  <div class="field">
    <%= form.label :sales_person_code %>
    <%= form.text_area :sales_person_code, {class: 'form-control'} %>
  </div>

  <div class="field">
    <%= form.label :sales_person_name %>
    <%= form.text_area :sales_person_name, {class: 'form-control'} %>
  </div>
  
  
  
  
  <h3>Invoice Lines</h3>
  <div class="table-responsive">
    <table id="invoice_lines" class="table table-bordered">
      <thead>
        <tr>
          <th>Charge Type</th>
          <th>Item No</th>
          <th>Description</th>
          <th>Quantity</th>
          <th>Unit Price</th>
          <th>Amount</th>
        </tr>
      </thead>
      <tbody>
      
    <%= form.fields_for :invoice_lines do |invoice_line| %>
      <%= render 'invoice_line_fields', f: invoice_line %>
    <% end %> 
      </tbody>
    </table>
  </div>
  
   <!-- Add Invoice Line Button -->
  <button type="button" id="add_invoice_line" class="btn btn-primary">Add Invoice Line</button>
 
  <!-- Submit Button -->
  <div class="actions">
    <%= form.submit 'Save Invoice', class: 'btn btn-success' %>
  </div>
  
  
  
  
  
  
  
  
  
  
  
  


  

  <div class="actions">
    <%= form.submit %>

</div>

  <!-- Hidden template for new paymentline rows -->
  <script type="text/template" id="invoice_lines_template">
      <tr class="invoice_line">
      
            <td><input type="text" name="invoice[invoice_lines_attributes][NEW_RECORD][charge_type]" id="invoice_invoice_lines_attributes_NEW_RECORD_charge_type" </td>
         
             <td><input type="text" name="invoice[invoice_lines_attributes][NEW_RECORD][item_no]" id="invoice_invoice_lines_attributes_NEW_RECORD_item_no" </td>
        
            <td><input type="text" name="invoice[invoice_lines_attributes][NEW_RECORD][description]" id="invoice_invoice_lines_attributes_NEW_RECORD_description" </td>
        
           <td>
            <input type="number" name="invoice[invoice_lines_attributes][NEW_RECORD][quantity]" id="invoice_invoice_lines_attributes_NEW_RECORD_quantity" step="any" </td>
         
           <td> <input type="text" name="invoice[invoice_lines_attributes][NEW_RECORD][unit_of_measure]" id="invoice_invoice_lines_attributes_NEW_RECORD_unit_of_measure" </td>
          
            <td><input type="number" name="invoice[invoice_lines_attributes][NEW_RECORD][unit_price]" id="invoice_invoice_lines_attributes_NEW_RECORD_unit_price" step="any" </td>
        
            <td><input type="number" name="invoice[invoice_lines_attributes][NEW_RECORD][amount]" id="invoice_invoice_lines_attributes_NEW_RECORD_amount" step="any" </td>
           
          <td><button type="button" class="remove_invoice_line btn btn-danger">Remove Line</button></td>
      
      
    </tr>
  </script>
  
 





<script>
   document.addEventListener('DOMContentLoaded', function() {
  // Add new invoice line
  document.getElementById('add_invoice_line').addEventListener('click', function() {
    const template = document.querySelector('script[type="text/template"]').innerHTML;
    const tbody = document.querySelector('#invoice_lines tbody');
    const newRow = document.createElement('tr');
    newRow.innerHTML = template.replace(/new_invoice_lines/g, new Date().getTime()); // Ensure unique IDs
    tbody.appendChild(newRow);
  });

  // Remove payment line
  document.addEventListener('click', function(event) {
    if (event.target.classList.contains('remove_fields')) {
      event.preventDefault();
      const row = event.target.closest('tr');
      row.remove();
    }
  });
</script>

 


<% end %>

</div>
</div>

  


 
